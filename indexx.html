<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Financial Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root { --cbe: #003366; --gold: #c5a059; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f8fafc; display: flex; flex-direction: column; height: 100vh; }
        .nav { background: var(--cbe); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .main { display: flex; flex: 1; overflow: hidden; }
        .data-pane { flex: 1.2; overflow-y: auto; padding: 20px; border-right: 2px solid #e2e8f0; }
        .pdf-pane { flex: 0.8; background: #525659; border-left: 2px solid #333; }
        iframe { width: 100%; height: 100%; border: none; }
        .card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; overflow: hidden; border: 1px solid #e2e8f0; }
        .card-header { padding: 12px; background: #f8fafc; border-bottom: 1px solid #eee; font-weight: bold; color: var(--cbe); }
        .fx-grid { display: none; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .fx-card { background: white; padding: 10px; border-radius: 8px; border-top: 4px solid var(--gold); text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 13px; }
        .btn { background: var(--gold); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .num { font-family: 'Courier New', monospace; text-align: right; font-weight: bold; color: var(--cbe); }
    </style>
</head>
<body>

<div class="nav">
    <div style="font-weight: bold; font-size: 18px;">CBE Analytics Portal</div>
    <button class="btn" onclick="toggleFX()">üí∞ Exchange Rates (EGP)</button>
</div>

<div class="main">
    <div class="data-pane">
        <div id="fx-panel" class="fx-grid"></div>
        <div id="status" style="font-size: 13px; color: #64748b; margin-bottom: 15px;">üîç Scanning yoo.pdf for data tables...</div>
        <div id="table-output"></div>
    </div>
    <div class="pdf-pane">
        <iframe src="yoo.pdf" title="Original PDF Document"></iframe>
    </div>
</div>

<script>
    const PDF_PATH = 'yoo.pdf';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    async function toggleFX() {
        const p = document.getElementById('fx-panel');
        p.style.display = p.style.display === 'grid' ? 'none' : 'grid';
        if(p.style.display === 'grid') {
            try {
                const res = await fetch('https://open.er-api.com/v6/latest/USD');
                const d = await res.json();
                const egp = d.rates.EGP;
                const cur = { 'USD': 1, 'EUR': d.rates.EUR, 'JPY': d.rates.JPY, 'GBP': d.rates.GBP, 'CHF': d.rates.CHF, 'SAR': d.rates.SAR, 'AED': d.rates.AED };
                let h = '';
                for(let [c, r] of Object.entries(cur)) {
                    h += `<div class="fx-card"><b>${c}</b><br><b>${(egp/r).toFixed(3)}</b></div>`;
                }
                p.innerHTML = h;
            } catch(e) { p.innerHTML = "Syncing rates..."; }
        }
    }

    async function scrapePDF() {
        const out = document.getElementById('table-output');
        const st = document.getElementById('status');
        try {
            const pdf = await pdfjsLib.getDocument(PDF_PATH).promise;
            st.innerText = "‚úÖ Success: Extracting information from yoo.pdf...";
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                const rows = {};
                
                text.items.forEach(it => {
                    const y = Math.round(it.transform[5]);
                    if (!rows[y]) rows[y] = [];
                    rows[y].push({ x: it.transform[4], str: it.str.trim() });
                });

                let html = "";
                Object.keys(rows).sort((a,b) => b-a).forEach(y => {
                    const line = rows[y].sort((a,b) => a.x - b.x);
                    const txt = line.map(it => it.str).join(" ");
                    const nums = line.filter(it => /^-?[\d,.]+(\(.*\))?$/.test(it.str) && it.str.length > 1);
                    
                    if (nums.length >= 2 && /[A-Za-z]/.test(txt)) {
                        html += `<tr><td><b>${txt.replace(/[0-9,.( )]{2,}/g, '').trim()}</b></td><td class="num">${nums[0].str}</td><td class="num">${nums[nums.length-1].str}</td></tr>`;
                    }
                });

                if (html) {
                    out.innerHTML += `<div class="card"><div class="card-header">Statistical Data - Page ${i}</div><table><tbody>${html}</tbody></table></div>`;
                }
            }
        } catch (e) { st.innerText = "‚ùå File Not Found. Check yoo.pdf is in the main GitHub folder."; }
    }
    window.onload = scrapePDF;
</script>
</body>
</html>
