<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Financial Portal - Folder iii</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root { --cbe: #003366; --gold: #c5a059; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f1f5f9; display: flex; flex-direction: column; height: 100vh; }
        
        /* Layout */
        .nav { background: var(--cbe); color: white; padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .main { display: flex; flex: 1; overflow: hidden; }
        
        /* Left: Table Data */
        .data-pane { flex: 1.2; overflow-y: auto; padding: 20px; border-right: 2px solid #e2e8f0; }
        .card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e2e8f0; overflow: hidden; }
        .card-header { padding: 12px; background: #f8fafc; border-bottom: 1px solid #eee; font-weight: bold; color: var(--cbe); font-size: 14px; }
        
        /* Right: PDF Viewer */
        .pdf-pane { flex: 0.8; background: #525659; border-left: 2px solid #333; }
        iframe { width: 100%; height: 100%; border: none; }

        /* Exchange Rates */
        .fx-container { display: none; margin-bottom: 20px; }
        .fx-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; }
        .fx-card { background: white; padding: 15px; border-radius: 8px; border-top: 4px solid var(--gold); text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .fx-rate { font-family: monospace; font-weight: bold; font-size: 16px; color: var(--cbe); }

        /* Buttons */
        .btn { background: var(--gold); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn:hover { background: #b08e4d; transform: scale(1.05); }
        
        /* Table Content */
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; background: #f8fafc; color: #64748b; text-transform: uppercase; font-size: 11px; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .num { font-family: 'Courier New', monospace; text-align: right; font-weight: bold; }
    </style>
</head>
<body>

<div class="nav">
    <div style="font-size: 18px; font-weight: bold;">CBE Financial Dashboard (Folder: iii)</div>
    <button class="btn" onclick="toggleFX()">üí∞ Live Exchange Rates</button>
</div>

<div class="main">
    <div class="data-pane">
        <div id="fx-section" class="fx-container">
            <div class="fx-grid" id="fx-display">
                </div>
        </div>

        <div id="status" style="font-size: 13px; color: #64748b; margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 5px;">üîÑ Loading yoo.pdf from folder 'iii'...</div>
        <div id="table-output"></div>
    </div>

    <div class="pdf-pane">
        <iframe src="yoo.pdf" title="CBE PDF Source"></iframe>
    </div>
</div>

<script>
    // This script automatically looks for yoo.pdf in the same folder as index.html
    const PDF_PATH = 'yoo.pdf';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    async function toggleFX() {
        const sect = document.getElementById('fx-section');
        sect.style.display = sect.style.display === 'block' ? 'none' : 'block';
        if(sect.style.display === 'block') {
            const res = await fetch('https://open.er-api.com/v6/latest/USD');
            const d = await res.json();
            const egp = d.rates.EGP;
            // List of currencies you requested
            const currencies = {
                'USD': 1, 'EUR': d.rates.EUR, 'JPY': d.rates.JPY, 
                'GBP': d.rates.GBP, 'CHF': d.rates.CHF, 'SAR': d.rates.SAR, 'AED': d.rates.AED
            };
            let html = '';
            for(let [code, rateAgainstUSD] of Object.entries(currencies)) {
                let egpRate = (egp / rateAgainstUSD).toFixed(3);
                html += `<div class="fx-card"><b>${code}</b><div class="fx-rate">${egpRate}</div><small>EGP</small></div>`;
            }
            document.getElementById('fx-display').innerHTML = html;
        }
    }

    async function startExtraction() {
        const out = document.getElementById('table-output');
        const st = document.getElementById('status');
        try {
            const loadingTask = pdfjsLib.getDocument(PDF_PATH);
            const pdf = await loadingTask.promise;
            st.innerHTML = "‚úÖ <b>Extraction Success:</b> Displaying data from yoo.pdf below.";

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                
                const rows = {};
                textContent.items.forEach(it => {
                    const y = Math.round(it.transform[5]);
                    if (!rows[y]) rows[y] = [];
                    rows[y].push({ x: it.transform[4], str: it.str.trim() });
                });

                let pageHtml = "";
                Object.keys(rows).sort((a,b) => b-a).forEach(y => {
                    const line = rows[y].sort((a,b) => a.x - b.x);
                    const fullLineText = line.map(it => it.str).join(" ");
                    const nums = line.filter(it => /^-?[\d,.]+(\(.*\))?$/.test(it.str) && it.str.length > 1);

                    // If a line has text and at least 2 financial numbers, treat it as a table row
                    if (nums.length >= 2 && /[A-Za-z]/.test(fullLineText)) {
                        pageHtml += `<tr>
                            <td style="font-weight:600; color:#334155;">${fullLineText.replace(/[0-9,.( )]{2,}/g, '').trim()}</td>
                            <td class="num">${nums[0].str}</td>
                            <td class="num">${nums[nums.length-1].str}</td>
                        </tr>`;
                    }
                });

                if (pageHtml) {
                    out.innerHTML += `<div class="card">
                        <div class="card-header">Annex Statistics - Page ${i}</div>
                        <table><thead><tr><th>Indicator</th><th>Previous</th><th>Current</th></tr></thead>
                        <tbody>${pageHtml}</tbody></table></div>`;
                }
            }
        } catch (e) {
            st.innerHTML = "‚ùå <b>File Error:</b> Could not find 'yoo.pdf' in the 'iii' folder. Check filenames.";
        }
    }
    window.onload = startExtraction;
</script>
</body>
</html>
