<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Advanced Analytics Terminal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --cbe: #003366; --gold: #c5a059; --bg: #f8fafc; }
        body { font-family: 'Inter', system-ui, sans-serif; margin: 0; background: var(--bg); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .nav { background: var(--cbe); color: white; padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 10; }
        .main { display: flex; flex: 1; overflow: hidden; }
        .data-pane { flex: 1.2; overflow-y: auto; padding: 20px; border-right: 1px solid #e2e8f0; }
        .pdf-pane { flex: 0.8; background: #525659; }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* FX & Trend Section */
        .fx-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 5px solid var(--gold); }
        .fx-controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .select-box { padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-weight: bold; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
        .stat-item { text-align: center; background: #f1f5f9; padding: 10px; border-radius: 8px; }
        
        /* Table Styling */
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        .card-header { padding: 12px; background: #f8fafc; font-weight: bold; color: var(--cbe); border-bottom: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .num { font-family: monospace; text-align: right; font-weight: bold; color: var(--cbe); }
        .btn { background: var(--gold); color: white; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="nav">
    <div style="font-weight: bold; font-size: 20px;">CBE Unified Portal</div>
    <button class="btn" onclick="toggleFXPanel()">ğŸ“ˆ Exchange Trend Analysis</button>
</div>

<div class="main">
    <div class="data-pane">
        <div id="fx-panel" class="fx-card" style="display:none;">
            <div class="fx-controls">
                <select id="currencySelector" class="select-box" onchange="updateChart()">
                    <option value="USD">ğŸ‡ºğŸ‡¸ USD/EGP</option>
                    <option value="EUR">ğŸ‡ªğŸ‡º EUR/EGP</option>
                    <option value="GBP">ğŸ‡¬ğŸ‡§ GBP/EGP</option>
                    <option value="JPY">ğŸ‡¯ğŸ‡µ JPY/EGP</option>
                    <option value="CHF">ğŸ‡¨ğŸ‡­ CHF/EGP</option>
                    <option value="SAR">ğŸ‡¸ğŸ‡¦ SAR/EGP</option>
                    <option value="AED">ğŸ‡¦ğŸ‡ª AED/EGP</option>
                </select>
                <div style="padding-top:10px; font-size: 12px; color: #64748b;">Historical Trend: Jan 2022 â€” Today</div>
            </div>
            
            <canvas id="variationChart" height="150"></canvas>
            
            <div class="stats-grid" id="stats-display">
                </div>
        </div>

        <div id="status" style="font-size: 13px; color: #64748b; margin-bottom: 15px;">ğŸ” Extracting Tables...</div>
        <div id="table-output"></div>
    </div>

    <div class="pdf-pane">
        <iframe src="yoo.pdf" title="CBE Official Document"></iframe>
    </div>
</div>

<script>
    const PDF_PATH = 'yoo.pdf';
    let myChart = null;

    function toggleFXPanel() {
        const p = document.getElementById('fx-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        if(p.style.display === 'block') updateChart();
    }

    // Logic for Historical Variation (Simulated based on historical EGP float events)
    function updateChart() {
        const ctx = document.getElementById('variationChart').getContext('2d');
        const currency = document.getElementById('currencySelector').value;
        
        // Months from Jan 2022 to Dec 2025
        const labels = ['Jan 22', 'Jun 22', 'Jan 23', 'Jun 23', 'Jan 24', 'Jun 24', 'Jan 25', 'Today'];
        
        // Approximated Historical Data for EGP devaluation stages
        const baseData = {
            'USD': [15.70, 18.80, 24.70, 30.90, 30.95, 48.00, 49.50, 50.10],
            'EUR': [17.80, 20.10, 26.50, 33.20, 34.00, 52.10, 53.80, 54.20],
            'SAR': [4.18, 5.01, 6.57, 8.23, 8.25, 12.80, 13.10, 13.35]
        };

        const currentData = baseData[currency] || baseData['USD'].map(v => v * 1.1); // Placeholder for others
        const startVal = currentData[0];
        const endVal = currentData[currentData.length - 1];
        const variation = (((endVal - startVal) / startVal) * 100).toFixed(1);

        if (myChart) myChart.destroy();
        
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `${currency} to EGP Trend`,
                    data: currentData,
                    borderColor: '#c5a059',
                    backgroundColor: 'rgba(197, 160, 89, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });

        document.getElementById('stats-display').innerHTML = `
            <div class="stat-item"><small>Jan 2022</small><br><b>${startVal}</b></div>
            <div class="stat-item"><small>Current</small><br><b>${endVal}</b></div>
            <div class="stat-item" style="color:red"><small>Total Variation</small><br><b>+${variation}%</b></div>
        `;
    }

    // PDF Scraper remains the same to ensure data extraction
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    async function init() {
        const out = document.getElementById('table-output');
        const st = document.getElementById('status');
        try {
            const pdf = await pdfjsLib.getDocument(PDF_PATH).promise;
            st.innerText = "âœ… PDF Data Sync Active";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                const rows = {};
                text.items.forEach(it => {
                    const y = Math.round(it.transform[5]);
                    if (!rows[y]) rows[y] = [];
                    rows[y].push({ x: it.transform[4], str: it.str.trim() });
                });
                let html = "";
                Object.keys(rows).sort((a,b) => b-a).forEach(y => {
                    const line = rows[y].sort((a,b) => a.x - b.x);
                    const txt = line.map(it => it.str).join(" ");
                    const nums = line.filter(it => /^-?[\d,.]+(\(.*\))?$/.test(it.str) && it.str.length > 1);
                    if (nums.length >= 2 && /[A-Za-z]/.test(txt)) {
                        html += `<tr><td><b>${txt.replace(/[0-9,.( )]{2,}/g, '').trim()}</b></td><td class="num">${nums[0].str}</td><td class="num">${nums[nums.length-1].str}</td></tr>`;
                    }
                });
                if (html) out.innerHTML += `<div class="card"><div class="card-header">Page ${i}</div><table><tbody>${html}</tbody></table></div>`;
            }
        } catch (e) { st.innerText = "âŒ PDF Load Error"; }
    }
    window.onload = init;
</script>
</body>
</html>
