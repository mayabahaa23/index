<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Command Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --cbe: #003366; --gold: #c5a059; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; height: 100vh; display: flex; flex-direction: column; }
        
        /* HEADER & BUTTON BAR */
        .header { background: var(--cbe); color: white; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .button-bar { background: white; padding: 15px; display: flex; justify-content: center; gap: 15px; border-bottom: 2px solid var(--gold); }
        
        .btn { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; font-size: 13px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-blue { background: var(--cbe); color: white; }
        .btn-gold { background: var(--gold); color: white; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* CONTENT AREA */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        .content-left { flex: 1; overflow-y: auto; padding: 20px; }
        .content-right { flex: 1; background: #525659; display: none; border-left: 4px solid var(--gold); } /* PDF Hidden by default */
        iframe { width: 100%; height: 100%; border: none; }

        /* CARDS */
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--cbe); }
        .controls-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 20px; background: #f8fafc; padding: 15px; border-radius: 8px; }
        
        select { padding: 8px; border-radius: 4px; border: 1px solid #ccc; width: 100%; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .num { font-family: 'Courier New', monospace; font-weight: bold; text-align: right; color: var(--cbe); }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0">Central Bank of Egypt Data Terminal</h1>
</div>

<div class="button-bar">
    <button class="btn btn-blue" onclick="window.open('yoo.pdf', '_blank')">1. üìë Pop-up PDF (New Tab)</button>
    <button class="btn btn-blue" onclick="togglePDF()">2. üëÅÔ∏è Show/Hide PDF Here</button>
    <button class="btn btn-gold" onclick="toggleSection('fx-table-section')">3. üí∞ Exchange Rates</button>
    <button class="btn btn-gold" onclick="toggleSection('trend-map-section')">4. üó∫Ô∏è Trend Map</button>
</div>

<div class="main-layout">
    <div class="content-left">
        
        <div id="fx-table-section" class="card" style="display:none;">
            <h2 style="color:var(--cbe); margin-top:0;">Live Exchange Rates (EGP)</h2>
            <table id="fx-table">
                <thead><tr><th>Currency</th><th>Pair</th><th>Rate</th></tr></thead>
                <tbody id="fx-body"></tbody>
            </table>
        </div>

        <div id="trend-map-section" class="card" style="display:none;">
            <h2 style="color:var(--cbe); margin-top:0;">Currency Variation Map</h2>
            
            <div class="controls-row">
                <div>
                    <label><b>Currency</b></label>
                    <select id="curSelector" onchange="updateMap()"><option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option><option value="SAR">SAR</option></select>
                </div>
                <div>
                    <label><b>From (Start)</b></label>
                    <select id="rangeStart" onchange="updateMap()">
                        <option value="0">Jan 2022</option><option value="6">Jul 2022</option>
                        <option value="12">Jan 2023</option><option value="18">Jul 2023</option>
                        <option value="24">Jan 2024</option><option value="30">Jul 2024</option>
                        <option value="36">Jan 2025</option>
                    </select>
                </div>
                <div>
                    <label><b>To (End)</b></label>
                    <select id="rangeEnd" onchange="updateMap()">
                        <option value="6">Jul 2022</option><option value="12">Jan 2023</option>
                        <option value="18">Jul 2023</option><option value="24">Jan 2024</option>
                        <option value="30">Jul 2024</option><option value="36">Jan 2025</option>
                        <option value="47" selected>Today (Dec 2025)</option>
                    </select>
                </div>
                <div style="text-align:center;">
                    <label><b>Variation</b></label><br>
                    <span id="varResult" style="font-size:18px; color:red; font-weight:bold;">--%</span>
                </div>
            </div>
            
            <canvas id="mainChart" height="150"></canvas>
        </div>

        <div id="pdf-extraction-area"></div>
    </div>

    <div class="content-right" id="pdf-viewer">
        <iframe src="yoo.pdf"></iframe>
    </div>
</div>

<script>
    // 1. SHOW/HIDE PDF
    function togglePDF() {
        const pdf = document.getElementById('pdf-viewer');
        pdf.style.display = (pdf.style.display === 'none' || pdf.style.display === '') ? 'block' : 'none';
    }

    // 2. TOGGLE DATA SECTIONS
    function toggleSection(id) {
        const sec = document.getElementById(id);
        sec.style.display = (sec.style.display === 'none') ? 'block' : 'none';
        if(id === 'fx-table-section') fetchFX();
        if(id === 'trend-map-section') updateMap();
    }

    // 3. FETCH LIVE FX RATES
    async function fetchFX() {
        try {
            const res = await fetch('https://open.er-api.com/v6/latest/USD');
            const data = await res.json();
            const egp = data.rates.EGP;
            const list = ['USD', 'EUR', 'GBP', 'JPY', 'CHF', 'SAR', 'AED'];
            let html = '';
            list.forEach(c => {
                let r = (egp / data.rates[c]).toFixed(2);
                html += `<tr><td><b>${c}</b></td><td>${c}/EGP</td><td class="num">${r}</td></tr>`;
            });
            document.getElementById('fx-body').innerHTML = html;
        } catch(e) { document.getElementById('fx-body').innerHTML = "Loading..."; }
    }

    // 4. HISTORICAL TREND MAP LOGIC
    let chartObj = null;
    const history = {
        'USD': [15.7, 18.2, 18.9, 19.5, 24.5, 27.2, 30.5, 30.8, 30.9, 45.2, 47.8, 48.5, 49.2, 50.1],
        'EUR': [17.5, 19.8, 20.2, 21.5, 26.2, 29.1, 33.1, 33.5, 33.8, 49.5, 51.2, 52.5, 53.8, 54.2],
        'SAR': [4.18, 4.85, 5.05, 5.20, 6.50, 7.25, 8.12, 8.22, 8.25, 12.0, 12.7, 12.9, 13.1, 13.3]
    };

    function updateMap() {
        const cur = document.getElementById('curSelector').value;
        const startIdx = parseInt(document.getElementById('rangeStart').value);
        const endIdx = parseInt(document.getElementById('rangeEnd').value);
        
        const full = history[cur] || history['USD'];
        // Mapping indices to data slice
        const dataSlice = full.slice(0, 14); // Simplified historical points
        const labels = ["Jan 22", "Jul 22", "Jan 23", "Jul 23", "Jan 24", "Jul 24", "Jan 25", "Dec 25"];
        
        const startVal = dataSlice[0];
        const endVal = dataSlice[dataSlice.length - 1];
        const variation = (((endVal - startVal) / startVal) * 100).toFixed(1);
        document.getElementById('varResult').innerText = `+${variation}%`;

        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chartObj) chartObj.destroy();
        chartObj = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: cur + ' Growth',
                    data: dataSlice,
                    borderColor: '#c5a059',
                    backgroundColor: 'rgba(197, 160, 89, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            }
        });
    }

    // 5. AUTOMATIC PDF SCANNER
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    async function initPDF() {
        try {
            const pdf = await pdfjsLib.getDocument('yoo.pdf').promise;
            let outputHtml = '';
            for(let i=1; i<=pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                let tableRows = '';
                text.items.forEach(it => {
                    if(/[0-9]/.test(it.str) && it.str.length > 5) {
                        tableRows += `<tr><td>${it.str}</td></tr>`;
                    }
                });
                if(tableRows) {
                    outputHtml += `<div class="card"><h3>Extracted Data: Page ${i}</h3><table>${tableRows}</table></div>`;
                }
            }
            document.getElementById('pdf-extraction-area').innerHTML = outputHtml;
        } catch(e) { console.log("Waiting for yoo.pdf..."); }
    }
    window.onload = initPDF;
</script>

</body>
</html>
