<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Precision Terminal - Official 2025 Rates</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <style>
        :root { --cbe: #003366; --gold: #c5a059; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; color: #333; }
        
        /* Header & Navigation */
        .header { background: var(--cbe); color: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--gold); }
        .button-bar { background: white; padding: 12px; display: flex; justify-content: center; gap: 12px; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 100; }
        
        .btn { padding: 10px 22px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-blue { background: var(--cbe); color: white; }
        .btn-gold { background: var(--gold); color: white; }

        /* Main Layout */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .left-panel { flex: 1; overflow-y: auto; padding: 25px; }
        .right-panel { flex: 1; background: #525659; display: none; } 
        iframe { width: 100%; height: 100%; border: none; }

        /* UI Components */
        .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); border-top: 3px solid var(--gold); }
        .filter-row { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; background: #f8fafc; padding: 15px; border-radius: 8px; align-items: flex-end; }
        
        select { padding: 9px; border-radius: 5px; border: 1px solid #cbd5e1; min-width: 150px; background: white; }
        #varDisplay { font-size: 24px; font-weight: bold; color: #dc2626; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; background: #f1f5f9; color: var(--cbe); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
        td, th { padding: 14px; border-bottom: 1px solid #e2e8f0; }
        .rate-cell { font-family: 'Consolas', monospace; font-weight: bold; color: var(--cbe); font-size: 16px; }

        /* Year/Month Menu */
        #year-menu { display:none; position:absolute; top:45px; left:0; z-index:1000; min-width:300px; border:1px solid #ddd; padding: 15px; background: white; }
        #month-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; margin-top:10px; }
        .month-btn { padding: 8px; font-size: 11px; background: #f1f5f9; border: 1px solid #ddd; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .month-btn:hover { background: var(--gold); color: white; }
    </style>
</head>
<body>

<div class="header"><h2 style="margin:0">CBE Precision Data Center</h2></div>

<div class="button-bar">
    <button class="btn btn-blue" onclick="window.open('yoo.pdf')">üìë 1. Pop-up PDF</button>
    <div style="display:inline-block; position:relative;">
        <button class="btn btn-blue" onclick="toggleYearMenu()">üëÅÔ∏è 2. Web PDF View</button>
        <div id="year-menu" class="card">
            <div style="display:flex; gap:10px; justify-content: center;">
                <button class="btn btn-gold" onclick="showMonths('2024')">2024</button>
                <button class="btn btn-gold" onclick="showMonths('2025')">2025</button>
            </div>
            <div id="month-grid"></div>
        </div>
    </div>
    <button class="btn btn-gold" onclick="toggleSec('fx-sec')">üí∞ 3. Live FX Table</button>
    <button class="btn btn-gold" onclick="toggleSec('map-sec')">üó∫Ô∏è 4. Market Trends</button>
</div>

<div class="main-container">
    <div class="left-panel">
        <div id="fx-sec" class="card" style="display:none;">
            <h3>Official Exchange Rates (CBE Reference)</h3>
            <table id="fx-table">
                <thead><tr><th>Currency</th><th>Rate (EGP)</th><th>Status</th></tr></thead>
                <tbody id="fx-body"></tbody>
            </table>
            <p id="timestamp" style="font-size: 11px; color: #666; margin-top: 10px;"></p>
        </div>

        <div id="map-sec" class="card" style="display:none;">
            <h3>Strategic Trend Analysis</h3>
            <div class="filter-row">
                <div class="filter-group"><label>Currency</label><br><select id="cur" onchange="updateMap()"></select></div>
                <div class="filter-group"><label>From</label><br><select id="start" onchange="updateMap()"></select></div>
                <div class="filter-group"><label>To</label><br><select id="end" onchange="updateMap()"></select></div>
                <div class="filter-group"><label>Period Var.</label><div id="varDisplay">0%</div></div>
            </div>
            <canvas id="chartCanvas" height="130"></canvas>
        </div>

        <div id="pdf-data"></div>
    </div>

    <div class="right-panel" id="pdf-panel">
        <iframe id="pdf-frame" src=""></iframe>
    </div>
</div>

<script>
    // Initialize PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    const cbeOfficial = { 'USD': 47.531, 'EUR': 56.001, 'GBP': 64.276, 'CHF': 60.336, 'SAR': 12.672, 'AED': 12.939, 'JPY': 0.304 };
    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const fullTimeline = [];
    [2022, 2023, 2024, 2025].forEach(y => monthNames.forEach(m => fullTimeline.push(`${m} ${y}`)));

    const ratesArchive = {
        USD: [15.7, 15.7, 15.7, 18.3, 18.5, 18.7, 18.9, 19.1, 19.3, 19.6, 24.2, 24.7, 29.8, 30.5, 30.8, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 30.9, 47.5, 48.2, 47.9, 47.5, 48.1, 48.5, 48.3, 48.1, 49.2, 49.5, 48.8, 48.5, 48.2, 47.9, 47.5, 47.2, 47.4, 47.6, 47.3, 47.2, 47.1, 47.4],
        EUR: [17.8, 17.7, 17.5, 19.8, 19.6, 19.7, 19.2, 19.1, 19.0, 19.3, 24.5, 26.1, 31.5, 32.4, 33.1, 33.7, 33.5, 33.8, 34.2, 33.9, 33.2, 33.6, 33.8, 34.1, 33.9, 33.5, 51.5, 52.3, 51.8, 51.2, 52.1, 52.8, 53.4, 53.1, 52.5, 52.2, 52.8, 52.4, 53.1, 53.9, 54.2, 54.5, 54.7, 54.9, 55.1, 55.0, 54.8, 55.0],
        GBP: [21.3, 21.1, 20.8, 23.9, 23.1, 23.0, 22.8, 22.5, 22.1, 22.4, 28.2, 30.1, 35.9, 36.8, 37.5, 38.4, 38.6, 39.2, 39.8, 39.4, 38.9, 38.1, 38.5, 39.1, 39.3, 39.1, 60.1, 61.2, 60.5, 60.1, 61.5, 62.1, 62.8, 63.5, 63.8, 63.2, 63.4, 63.1, 63.3, 63.5, 63.1, 62.9, 63.2, 63.5, 63.3, 63.1, 63.1, 63.4],
        SAR: [4.18, 4.18, 4.18, 4.88, 4.93, 4.98, 5.03, 5.09, 5.14, 5.22, 6.44, 6.57, 7.93, 8.12, 8.20, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 8.23, 12.6, 12.8, 12.7, 12.6, 12.8, 12.9, 12.8, 12.8, 13.1, 13.2, 13.0, 12.9, 12.8, 12.7, 12.6, 12.5, 12.6, 12.6, 12.6, 12.6, 12.5, 12.6],
        AED: [4.27, 4.27, 4.27, 4.98, 5.03, 5.09, 5.14, 5.20, 5.25, 5.33, 6.58, 6.72, 8.11, 8.30, 8.38, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 8.41, 12.9, 13.1, 13.0, 12.9, 13.1, 13.2, 13.1, 13.1, 13.4, 13.5, 13.2, 13.2, 13.1, 13.0, 12.9, 12.8, 12.9, 12.9, 12.8, 12.8, 12.8, 12.9],
        CHF: [17.1, 17.0, 16.9, 19.5, 19.1, 19.4, 19.5, 19.8, 20.1, 20.5, 25.4, 26.6, 32.1, 32.8, 33.4, 34.2, 34.5, 34.8, 35.5, 35.1, 34.8, 34.9, 35.2, 36.1, 36.3, 35.8, 53.5, 54.2, 53.6, 53.1, 54.5, 55.2, 56.1, 56.5, 56.1, 55.8, 56.4, 56.8, 57.2, 57.8, 58.1, 58.4, 58.8, 59.1, 58.9, 58.8, 58.8, 58.9],
        JPY: [13.6, 13.5, 12.9, 14.5, 14.3, 13.9, 13.8, 13.9, 13.5, 13.3, 17.2, 18.2, 22.5, 23.1, 23.4, 23.1, 22.2, 21.8, 21.5, 21.2, 20.9, 20.5, 20.8, 21.4, 21.2, 20.8, 31.5, 32.1, 31.2, 30.5, 31.1, 31.8, 33.5, 32.8, 31.9, 32.2, 31.8, 31.5, 31.1, 30.8, 30.5, 30.1, 30.2, 30.4, 29.9, 29.8, 29.9, 30.0]
    };

    function toggleYearMenu() { 
        const m = document.getElementById('year-menu'); 
        m.style.display = (m.style.display === 'block') ? 'none' : 'block'; 
    }

    function showMonths(year) {
        const grid = document.getElementById('month-grid');
        grid.innerHTML = '';
        monthNames.forEach(m => {
            const btn = document.createElement('button');
            btn.className = 'month-btn';
            btn.innerText = m;
            
            let f = `${year}-${m}.pdf`;
            if (year === '2025') {
                if (m === 'Dec') f = 'yoo.pdf';
                if (m === 'Nov') f = 'novv.pdf';
                if (m === 'Oct') f = 'octt.pdf';
                if (m === 'Sep') f = 'yoo.pdf';
                if (m === 'Aug') f = 'augg.pdf';
                if (m === 'Jul') f = 'julyy.pdf';
                if (m === 'Jun') f = 'junee.pdf';
                if (m === 'May') f = 'mayy.pdf';
                if (m === 'Apr') f = 'aprr.pdf';
            }

            btn.onclick = () => { loadSpecificPDF(f); toggleYearMenu(); };
            grid.appendChild(btn);
        });
    }

    async function loadSpecificPDF(f) {
        const panel = document.getElementById('pdf-panel');
        const frame = document.getElementById('pdf-frame');
        frame.src = f;
        panel.style.display = 'block';
        initScraper(f);
    }

    async function initScraper(f) {
        const display = document.getElementById('pdf-data');
       
        
        try {
            // Load PDF with specific parameters for local reading
            const loadingTask = pdfjsLib.getDocument({
                url: f,
                disableRange: true,
                disableStream: true
            });
            
            const pdf = await loadingTask.promise;
            let h = `<h3>Extract from ${f}</h3>`;
            
            for(let i=1; i<=Math.min(pdf.numPages, 3); i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                let rows = '';
                text.items.forEach(it => { 
                    if(it.str.trim().length > 10) rows += `<tr><td>${it.str}</td></tr>`; 
                });
                if(rows) h += `<div class="card"><h4>Page ${i}</h4><table>${rows}</table></div>`;
            }
            display.innerHTML = h;
        } catch(e) { 
            console.error(e);
            display.innerHTML = `
                <div class="card" style="border-top:3px solid red">
                    <h4 style="color:red">‚ö†Ô∏è Error Loading Data</h4>
                    <p>Filename: <b>${f}</b></p>
                    <p><i>Note: Browsers block local file access. Please use "Live Server" or host this on a web server.</i></p>
                </div>`; 
        }
    }

    function populateDropdowns() {
        const s = document.getElementById('start'), e = document.getElementById('end'), c = document.getElementById('cur');
        fullTimeline.forEach((m, i) => {
            s.innerHTML += `<option value="${i}">${m}</option>`;
            e.innerHTML += `<option value="${i}" ${i==47?'selected':''}>${m}</option>`;
        });
        Object.keys(ratesArchive).forEach(curr => c.innerHTML += `<option value="${curr}">${curr}</option>`);
    }

    let myChart = null;
    function updateMap() {
        const curr = document.getElementById('cur').value, s = parseInt(document.getElementById('start').value), e = parseInt(document.getElementById('end').value);
        if(s >= e) return;
        const labels = fullTimeline.slice(s, e + 1), data = ratesArchive[curr].slice(s, e + 1);
        document.getElementById('varDisplay').innerText = `+${(((data[data.length-1]-data[0])/data[0])*100).toFixed(1)}%`;
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            plugins: [ChartDataLabels],
            data: { labels: labels, datasets: [{ data: data, borderColor: '#c5a059', backgroundColor: 'rgba(197, 160, 89, 0.1)', fill: true, tension: 0.3 }] },
            options: { plugins: { datalabels: { display: false }, legend: {display:false} }, scales: { y: { grace: '15%' } } }
        });
    }

    async function loadFX() {
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            const d = await res.json();
            const usdAnchor = cbeOfficial.USD; 
            let h = '';
            Object.keys(cbeOfficial).forEach(curr => {
                const finalRate = (curr === 'USD') ? usdAnchor.toFixed(4) : ((1 / d.rates[curr]) * usdAnchor).toFixed(4);
                h += `<tr><td><b>${curr}</b></td><td class="rate-cell">${finalRate}</td><td><span style="color:green">‚óè Verified</span></td></tr>`;
            });
            document.getElementById('fx-body').innerHTML = h;
            document.getElementById('timestamp').innerText = "Last Sync: " + new Date().toLocaleString();
        } catch(e) {
            let h = '';
            Object.keys(cbeOfficial).forEach(curr => { h += `<tr><td><b>${curr}</b></td><td class="rate-cell">${cbeOfficial[curr]}</td><td><span style="color:orange">‚óè Offline</span></td></tr>`; });
            document.getElementById('fx-body').innerHTML = h;
        }
    }

    function toggleSec(id) { 
        const s = document.getElementById(id); 
        s.style.display = (s.style.display==='none')?'block':'none'; 
        if(id==='fx-sec') loadFX(); 
        if(id==='map-sec') updateMap(); 
    }

    window.onload = () => { 
        populateDropdowns(); 
        initScraper('yoo.pdf'); // Load default file data
    };
</script>
</body>
</html>

